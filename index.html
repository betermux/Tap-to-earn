<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fruit Slice —Ç–æ–≥–ª–æ–æ–º</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body {
      margin: 0;
      height: 100vh;
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #24fe41, #fdfc47);
      text-align: center;
      overflow: hidden;
    }
    #container {
      margin: 0 auto;
      max-width: 800px;
      height: 600px;
      position: relative;
      box-shadow: -4px 4px 35px 2px green;
    }
    #game-screen {
      height: 450px;
      background: #fff;
      background-size: cover;
      position: relative;
      overflow: hidden;
    }
    #fruit-container {
      position: relative;
      height: 100%;
    }
    .fruit {
      position: absolute;
      font-size: 50px;
      display: none;
      cursor: pointer;
      user-select: none;
    }
    #start-btn, #restart-btn {
      width: 150px;
      height: 40px;
      font-size: 20px;
      background: white;
      color: red;
      border: none;
      border-radius: 3px;
      box-shadow: -2px 2px 14px 2px red;
      cursor: pointer;
      margin-top: 10px;
    }
    #game-over {
      position: absolute;
      width: 300px;
      height: 200px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      top: 200px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px;
      font-size: 30px;
      display: none;
      z-index: 10;
    }
    #score, #lives {
      font-size: 24px;
      color: white;
      text-shadow: 1px 1px 2px black;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="instructions">–ñ–∏–º—Å —Ö—ç—Ä—á—ç—ç—Ä—ç–π!</div>
    <div id="score">–û–Ω–æ–æ: <span id="score-value">0</span></div>
    <div id="lives">–ê–º—å: <span id="lives-value">3</span></div>
    <div id="game-screen">
      <div id="fruit-container"></div>
    </div>
    <button id="start-btn">–≠—Ö–ª—ç—Ö</button>
    <div id="game-over">
      <div>–¢–æ–≥–ª–æ–æ–º –¥—É—É—Å–ª–∞–∞!</div>
      <div>–¢–∞–Ω—ã –æ–Ω–æ–æ: <span id="final-score"></span></div>
      <button id="restart-btn">–î–∞—Ö–∏–Ω —ç—Ö–ª—ç—Ö</button>
    </div>
  </div>

  <audio id="slice-sound" src="https://cdn.pixabay.com/download/audio/2023/03/13/audio_b4c0d2e709.mp3?filename=fruit-slice-14510.mp3"></audio>

  <script>
    $(document).ready(function () {
      let score = 0;
      let lives = 3;
      let isPlaying = false;
      let fruitInterval;

      if (window.Telegram.WebApp) {
        window.Telegram.WebApp.ready();
        const user = window.Telegram.WebApp.initDataUnsafe.user;
        if (user) {
          $('#instructions').text(`–°–∞–π–Ω –±–∞–π–Ω–∞ —É—É, ${user.first_name}! –ñ–∏–º—Å —Ö—ç—Ä—á—ç—ç—Ä—ç–π!`);
        }
      }

      $('#start-btn').on('click', function () {
        if (!isPlaying) {
          score = 0;
          lives = 3;
          isPlaying = true;
          $('#score-value').text(score);
          $('#lives-value').text(lives);
          $('#game-over').hide();
          $('#start-btn').text('–î–∞—Ö–∏–Ω —ç—Ö–ª“Ø“Ø–ª—ç—Ö');
          spawnFruits();

          if (window.Telegram.WebApp) {
            window.Telegram.WebApp.MainButton
              .setText('–û–Ω–æ–æ–≥–æ–æ —Ö—É–≤–∞–∞–ª—Ü–∞—Ö')
              .show()
              .onClick(() => {
                window.Telegram.WebApp.sendData(JSON.stringify({ score: score }));
              });
          }
        } else {
          resetGame();
        }
      });

      function spawnFruits() {
        fruitInterval = setInterval(function () {
          const fruit = $('<div>', {
            class: 'fruit',
            text: 'üçâ',
            css: {
              top: -60,
              left: Math.random() * ($('#fruit-container').width() - 50)
            }
          });

          $('#fruit-container').append(fruit);
          fruit.show();

          let fallSpeed = Math.floor(Math.random() * 5) + 2;
          const moveFruit = setInterval(function () {
            fruit.css('top', fruit.position().top + fallSpeed);
            if (fruit.position().top > $('#fruit-container').height()) {
              fruit.remove();
              lives--;
              $('#lives-value').text(lives);
              if (lives <= 0) {
                endGame();
              }
              clearInterval(moveFruit);
            }
          }, 20);

          fruit.on('click touchstart', function (e) {
            e.preventDefault();
            score++;
            $('#score-value').text(score);
            $('#slice-sound')[0].currentTime = 0;
            $('#slice-sound')[0].play();
            fruit.text('üí•');
            clearInterval(moveFruit);
            setTimeout(() => fruit.remove(), 300);
          });
        }, 1500);
      }

      function endGame() {
        isPlaying = false;
        clearInterval(fruitInterval);
        $('#game-over').show();
        $('#final-score').text(score);
        $('#start-btn').text('–≠—Ö–ª—ç—Ö');
        $('.fruit').remove();
        if (window.Telegram.WebApp) {
          window.Telegram.WebApp.MainButton.hide();
        }
      }

      function resetGame() {
        isPlaying = false;
        clearInterval(fruitInterval);
        score = 0;
        lives = 3;
        $('#score-value').text(score);
        $('#lives-value').text(lives);
        $('#game-over').hide();
        $('.fruit').remove();
        if (window.Telegram.WebApp) {
          window.Telegram.WebApp.MainButton.hide();
        }
      }

      $('#restart-btn').on('click', function () {
        resetGame();
        $('#start-btn').trigger('click');
      });
    });
  </script>
</body>
</html>